From 306f5cc1f38a903ad8a480c06432d61b3db100a3 Mon Sep 17 00:00:00 2001
From: Carlos Alberto Lopez Perez <clopez@igalia.com>
Date: Tue, 19 Dec 2017 03:41:55 +0100
Subject: [PATCH 3/6] Revert "gldisplay: add a list of glwindow's"

This reverts commit e4916fb1ef8e5ecc075978b98f50bd799faf83e0.
---
 docs/libs/gst-plugins-bad-libs-sections.txt |  3 -
 gst-libs/gst/gl/gstglcontext.c              |  2 +-
 gst-libs/gst/gl/gstgldisplay.c              | 92 -----------------------------
 gst-libs/gst/gl/gstgldisplay.h              |  8 +--
 4 files changed, 2 insertions(+), 103 deletions(-)

diff --git a/docs/libs/gst-plugins-bad-libs-sections.txt b/docs/libs/gst-plugins-bad-libs-sections.txt
index 3f0faa1d5..61e804343 100644
--- a/docs/libs/gst-plugins-bad-libs-sections.txt
+++ b/docs/libs/gst-plugins-bad-libs-sections.txt
@@ -1041,9 +1041,6 @@ gst_gl_display_add_context
 gst_gl_display_get_gl_context_for_thread
 gst_gl_display_get_handle
 gst_gl_display_create_context
-gst_gl_display_create_window
-gst_gl_display_find_window
-gst_gl_display_remove_window
 gst_context_get_gl_display
 gst_context_set_gl_display
 <SUBSECTION Standard>
diff --git a/gst-libs/gst/gl/gstglcontext.c b/gst-libs/gst/gl/gstglcontext.c
index b435a4920..bc9706943 100644
--- a/gst-libs/gst/gl/gstglcontext.c
+++ b/gst-libs/gst/gl/gstglcontext.c
@@ -258,7 +258,7 @@ _ensure_window (GstGLContext * context)
   if (context->window)
     return;
 
-  window = gst_gl_display_create_window (context->display);
+  window = gst_gl_window_new (context->display);
 
   gst_gl_context_set_window (context, window);
 
diff --git a/gst-libs/gst/gl/gstgldisplay.c b/gst-libs/gst/gl/gstgldisplay.c
index 9fc42e409..5378955ea 100644
--- a/gst-libs/gst/gl/gstgldisplay.c
+++ b/gst-libs/gst/gl/gstgldisplay.c
@@ -101,8 +101,6 @@ static guint gst_gl_display_signals[LAST_SIGNAL] = { 0 };
 static void gst_gl_display_dispose (GObject * object);
 static void gst_gl_display_finalize (GObject * object);
 static guintptr gst_gl_display_default_get_handle (GstGLDisplay * display);
-static GstGLWindow *gst_gl_display_default_create_window (GstGLDisplay *
-    display);
 
 struct _GstGLDisplayPrivate
 {
@@ -174,7 +172,6 @@ gst_gl_display_class_init (GstGLDisplayClass * klass)
       GST_TYPE_GL_CONTEXT, 1, GST_TYPE_GL_CONTEXT);
 
   klass->get_handle = gst_gl_display_default_get_handle;
-  klass->create_window = gst_gl_display_default_create_window;
 
   G_OBJECT_CLASS (klass)->finalize = gst_gl_display_finalize;
   G_OBJECT_CLASS (klass)->dispose = gst_gl_display_dispose;
@@ -533,95 +530,6 @@ gst_gl_display_create_context (GstGLDisplay * display,
   return ret;
 }
 
-/**
- * gst_gl_display_create_window:
- * @display: a #GstGLDisplay
- *
- * It requires the display's object lock to be held.
- *
- * Returns: (transfer full): a new #GstGLWindow for @display or %NULL.
- */
-GstGLWindow *
-gst_gl_display_create_window (GstGLDisplay * display)
-{
-  GstGLDisplayClass *klass;
-  GstGLWindow *window;
-
-  g_return_val_if_fail (GST_IS_GL_DISPLAY (display), NULL);
-  klass = GST_GL_DISPLAY_GET_CLASS (display);
-  g_return_val_if_fail (klass->create_window != NULL, NULL);
-
-  window = klass->create_window (display);
-
-  if (window)
-    display->windows = g_list_prepend (display->windows, window);
-
-  return window;
-}
-
-static GstGLWindow *
-gst_gl_display_default_create_window (GstGLDisplay * display)
-{
-  return gst_gl_window_new (display);
-}
-
-/**
- * gst_gl_display_remove_window:
- * @display: a #GstGLDisplay
- * @window: a #GstGLWindow to remove
- *
- * Returns: if @window could be removed from @display
- *
- * Since: 1.12
- */
-gboolean
-gst_gl_display_remove_window (GstGLDisplay * display, GstGLWindow * window)
-{
-  gboolean ret = FALSE;
-  GList *l;
-
-  GST_OBJECT_LOCK (display);
-  l = g_list_find (display->windows, window);
-  if (l) {
-    display->windows = g_list_delete_link (display->windows, l);
-    ret = TRUE;
-  }
-  GST_OBJECT_UNLOCK (display);
-
-  return ret;
-}
-
-/**
- * gst_gl_display_find_window:
- * @display: a #GstGLDisplay
- * @data: (closure): some data to pass to @compare_func
- * @compare_func: (scope call): a comparison function to run
- *
- * Execute @compare_func over the list of windows stored by @display.  The
- * first argment to @compare_func is the #GstGLWindow being checked and the
- * second argument is @data.
- *
- * Returns: (transfer none): The first #GstGLWindow that causes a match
- *          from @compare_func
- *
- * Since: 1.12
- */
-GstGLWindow *
-gst_gl_display_find_window (GstGLDisplay * display, gpointer data,
-    GCompareFunc compare_func)
-{
-  GstGLWindow *ret = NULL;
-  GList *l;
-
-  GST_OBJECT_LOCK (display);
-  l = g_list_find_custom (display->windows, data, compare_func);
-  if (l)
-    ret = l->data;
-  GST_OBJECT_UNLOCK (display);
-
-  return ret;
-}
-
 static GstGLContext *
 _get_gl_context_for_thread_unlocked (GstGLDisplay * display, GThread * thread)
 {
diff --git a/gst-libs/gst/gl/gstgldisplay.h b/gst-libs/gst/gl/gstgldisplay.h
index deac9dfe4..f5d42052c 100644
--- a/gst-libs/gst/gl/gstgldisplay.h
+++ b/gst-libs/gst/gl/gstgldisplay.h
@@ -80,7 +80,6 @@ struct _GstGLDisplay
   GstGLDisplayType      type;
 
   /* <protected> */
-  GList                    *windows;        /* OBJECT lock */
   GMainContext             *main_context;
   GMainLoop                *main_loop;
   GSource                  *event_source;
@@ -92,8 +91,7 @@ struct _GstGLDisplayClass
 {
   GstObjectClass object_class;
 
-  guintptr          (*get_handle)      (GstGLDisplay * display);
-  GstGLWindow *     (*create_window)    (GstGLDisplay * display);
+  guintptr (*get_handle)      (GstGLDisplay * display);
 
   /* <private> */
   gpointer _padding[GST_PADDING];
@@ -133,10 +131,6 @@ GST_EXPORT
 gboolean gst_gl_display_add_context (GstGLDisplay * display,
     GstGLContext * context);
 
-GstGLWindow *   gst_gl_display_create_window    (GstGLDisplay * display);
-gboolean        gst_gl_display_remove_window    (GstGLDisplay * display, GstGLWindow * window);
-GstGLWindow *   gst_gl_display_find_window      (GstGLDisplay * display, gpointer data, GCompareFunc compare_func);
-
 G_END_DECLS
 
 #endif /* __GST_GL_DISPLAY_H__ */
-- 
2.11.0

